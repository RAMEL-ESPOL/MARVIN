<?xml version="1.0"?>
<launch>

  <arg name="rvizconfig" default="$(find vehicle_gazebo)/rviz/vehicle_gazebo.rviz" />
  <arg name="model" default="$(find vehicle_description)/urdf/vehiculo.urdf.xacro" />
  <arg name="open_rviz" default="true" />
  <arg name="world" default="track2" />
  <arg name="namespace" default="/"/>
  <arg name="cmd_timeout" default="0.5"/>
    <env name="GAZEBO_MODEL_PATH" value="$(find vehicle_gazebo)/models:$(optenv GAZEBO_MODEL_PATH)"/>
  <arg name="world_name" default="$(find vehicle_gazebo)/worlds/$(arg world).world"/>

  <!-- Vehicle pose -->
  <arg name="x" default="2.3"/>
  <arg name="y" default="0.0"/>
  <arg name="z" default="0.6"/>
  <arg name="roll" default="0.0"/>
  <arg name="pitch" default="0.0"/>
  <arg name="yaw" default="1.57"/>

  <include file="$(find vehicle_description)/launch/vehicle.launch">
    <arg name="namespace" value="$(arg namespace)"/>
  </include>

  <group ns="$(arg namespace)">
    <!-- Create the world. -->
    <include file="$(find gazebo_ros)/launch/empty_world.launch">
      <arg name="world_name" value="$(arg world_name)"/>
      <arg name="gui" value="true"/>
    </include>
    <!-- Spawn the vehicle. -->
    <node name="spawn_vehicle" pkg="gazebo_ros" type="spawn_model"
          args="-urdf -param robot_description -model vehiculo_urdf_v2
                -gazebo_namespace /$(arg namespace)/gazebo
                -x $(arg x) -y $(arg y) -z $(arg z)
                -R $(arg roll) -P $(arg pitch) -Y $(arg yaw) "/>

    <node name="controller_spawner" pkg="controller_manager" type="spawner"
          args="$(find vehicle_gazebo)/config/vehicle_joint_ctrlr_params.yaml"/>

    <node name="ackermann_controller" pkg="vehicle_gazebo" type="ackermann_controller">
      <param name="cmd_timeout" value="$(arg cmd_timeout)"/>
      <rosparam file="$(find vehicle_gazebo)/config/vehicle_ackermann_ctrlr_params.yaml" command="load"/>
    </node>
  </group>

  <node name="cmd_to_ackermann" pkg="vehicle_gazebo" type="cmd_vel_to_ackermann_drive"/>

  <node name="rqt_robot_steering" pkg="rqt_robot_steering" type="rqt_robot_steering">
    <param name="default_topic" value="/cmd_vel" />
  </node>


  <!-- Robot localization
  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_aupol" clear_params="true">
    <rosparam command="load" file="$(find vehicle_gazebo)/config/ekf.yaml" />
    <remap from="odometry/filtered" to="odom" />
  </node>
-->
  <!-- Robot localization
-->
  <node pkg="tf" type="static_transform_publisher" name="odom_publisher_map_odom" args="0 0 0 0 0 0 1 map odom 1000" />
  <node pkg="vehicle_gazebo" name="odom_broadcaster" type="odom_broadcaster" launch-prefix="xterm -e" />

  <node if="$(arg open_rviz)" name="rviz" pkg="rviz" type="rviz" args="-d $(arg rvizconfig)" />

</launch>
